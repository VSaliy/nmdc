<HTML><HEAD><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><TITLE>$Z</TITLE></HEAD><BODY><TABLE width="100%" border="1"><TR><TH width="150">Author</TH><TH>Message</TH></TR><TR><TD valign="top" align="left"><B>CrazyGuy<BR></B>Administrator<BR>Full Member<BR> Offline<BR>Posts: 169<BR></TD><TD valign="top" align="left"><table width="100%" border="0"><tr><td valign="middle"><BR></TD><td valign="middle">$Z<BR>&#171; <B> on:</B> May 02, 2007, 08:47:03 PM &#187;</TD><td align="right" valign="bottom" height="20"></TD></TR></TABLE>The $Z command is used by the NMDC ZLine Extension, a proposed extension to the NMDC protocol<BR>Abstract<BR>This proposal is by Jove and has been discussed in the DCDev Public hub, but is being documented here.<BR>The proposal is to add a ZLine ($Z) command that returns a block of zipped commands.<BR>Quote$Z &lt;blob|<BR>would unzip to<BR>Quote$Search ... |$MyINFO|...<BR>The proposal for now is to use simple zlib compression and adding a minimal escaping. The escaping for now is: replace &quot;\&quot; by &quot;\\&quot; and &quot;|&quot; by &quot;\P&quot; . It would be trivial to use bzip instead.<BR>This would only be used for message passing from hub to client. The other way around is not useful and only generates extra load on the hub.<BR>The Client must send a $Supports flag called &quot;ZLine&quot;<BR>Evaluation<BR>I have performed a few basic tests to evaluate the effectiveness of the extension.<BR>The load test program runs in 2 stages. First, it joins all the users in the test, then all those users start generating &quot;events&quot;. An event is:<BR>a $MyINFOa chat messagea $Searcha disconnect/connect&nbsp;&nbsp;&nbsp;<BR>Delays between user joins and events can be programmed. Default settings are 100ms between user joins (10joins/s) and 50ms between events (20 events/s). Unless specified, the test was performed with default settings.<BR>A short test (about 700s) with 100 users.<BR>Quote Without ZLine<BR>&nbsp; &nbsp;Total traffic since boot: In 1986998, Out 58506319<BR>&nbsp; &nbsp;Average over 718 seconds: In 16.140272 kbps, Out 475.764798 kbps<BR>Quote With ZLine<BR>&nbsp; &nbsp;Total traffic since boot: In 1549938, Out 15913487<BR>&nbsp; &nbsp;Average over 719 seconds: In 16.159448 kbps, Out 165.737719 kbps<BR>This test has 1000 users connected to the hub. The test ran over 22000 seconds (a little over 6 hours) in both cases.<BR>Quote Without ZLine<BR>&nbsp; &nbsp;Total traffic since boot: In 58562006, Out 18932614671<BR>&nbsp; &nbsp;Average over 28078 seconds: In 16.682808 kbps, Out 5393.331647 kbps<BR>Quote With ZLine<BR>&nbsp; &nbsp;Total traffic since boot: In 48040395, Out 3987767021<BR>&nbsp; &nbsp;Average over 22318 seconds: In 16.989433 kbps, Out 1410.093335 kbps<BR>This test has 4000 users connected to the hub. The test ran over 5000 seconds in both cases.<BR>Quote Without ZLine<BR>&nbsp; &nbsp;Total traffic since boot: In 11675512, Out 14732322239<BR>&nbsp; &nbsp;Average over 5472 seconds: In 16.910506 kbps, Out 21337.779879 kbps<BR>Quote With ZLine<BR>&nbsp; &nbsp;Total traffic since boot: In 11102441, Out 2805387234<BR>&nbsp; &nbsp;Average over 5042 seconds: In 17.197069 kbps, Out 4343.892306 kbps<BR>Below tests were conducted with different messages. The basic message as above and a number of random characters. This results in larger messages that are harder to compress.<BR>1000 users<BR>Quote Without ZLine<BR>&nbsp; &nbsp;Total traffic since boot: In 26426307, Out 8802244496<BR>&nbsp; &nbsp;Average over 9358 seconds: In 22.585492 kbps, Out 7522.500261 kbps<BR>Quote With Zline<BR>&nbsp; &nbsp;Total traffic since boot: In 27070505, Out 4003114560<BR>&nbsp; &nbsp;Average over 9359 seconds: In 22.837603 kbps, Out 3376.263386 kbps<BR>Conclusion<BR>The bandwidth saved lies anywhere between 50% and 80% depending on the amount of users and the exact kind of traffic. I would also like to point out that the hub software used (my own, called Aquila) does not zip everything. The hub software aims at a nice balance between bandwidth and CPU/memory resources. In essence, only blocks of commands send to all users are zipped. This keeps the extra CPU/memory used almost negligible<BR>Deployment<BR>Hubs:<BR>Aquila (Jove&#039;&#039;s hub software)<BR>BDCH (planned)<BR>DDCH<BR>tkhub<BR>YnHub (promised)<BR>NitroHub (over 0.7)<BR>clients:<BR>DCDM++<BR>iDC++<BR>McDC++<BR>Z++<BR>bots:<BR>StatBot (2.6.6 &lt;)&nbsp; http://flow84.no-ip.org/dcstuff/statbot/<BR>Last syncronized November 19th 2006</TD></TR></TABLE></BODY></HTML>