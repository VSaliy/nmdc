<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0055)http://wiki.ptokax.ch/doku.php/misc/dcprotocol/lock2key -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
				
		<meta name="generator" content="DokuWiki Release 2009-02-14b">
<meta name="robots" content="index,follow">
<meta name="date" content="2010-05-25T20:55:07+0200">
<meta name="keywords" content="misc,dcprotocol,lock2key">
<link rel="search" type="application/opensearchdescription+xml" href="http://wiki.ptokax.ch/lib/exe/opensearch.php" title="WikiPx">
<link rel="start" href="http://wiki.ptokax.ch/">
<link rel="contents" href="http://wiki.ptokax.ch/doku.php/misc/dcprotocol/lock2key?do=index" title="Index">
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="http://wiki.ptokax.ch/feed.php">
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="http://wiki.ptokax.ch/feed.php?mode=list&ns=misc:dcprotocol">
<link rel="alternate" type="text/html" title="Plain HTML" href="http://wiki.ptokax.ch/doku.php/misc/dcprotocol/lock2key?do=export_xhtml">
<link rel="alternate" type="text/plain" title="Wiki Markup" href="http://wiki.ptokax.ch/doku.php/misc/dcprotocol/lock2key?do=export_raw">
<link rel="stylesheet" media="all" type="text/css" href="./misc dcprotocol lock2key - WikiPx_files/css.php">
<link rel="stylesheet" media="screen" type="text/css" href="./misc dcprotocol lock2key - WikiPx_files/css(1).php">
<link rel="stylesheet" media="print" type="text/css" href="./misc dcprotocol lock2key - WikiPx_files/css(2).php">
<script type="text/javascript" charset="utf-8" src="./misc dcprotocol lock2key - WikiPx_files/js.php"></script>
		<title>misc:dcprotocol:lock2key - WikiPx</title>
					<link rel="shortcut icon" href="http://wiki.ptokax.ch/lib/tpl/monobook/user/favicon.ico">
				<style type="text/css" media="screen,projection">/*<![CDATA[*/ @import "/lib/tpl/monobook/monobook/main.css"; /*]]>*/</style>

		<link rel="stylesheet" type="text/css" media="print" href="./misc dcprotocol lock2key - WikiPx_files/commonPrint.css">
		<link rel="stylesheet" type="text/css" media="print" href="./misc dcprotocol lock2key - WikiPx_files/print.css">

		<script type="text/javascript" src="./misc dcprotocol lock2key - WikiPx_files/wikibits.js"></script>
		<style type="text/css" media="screen,projection">/*<![CDATA[*/
		@import "/lib/tpl/monobook/wikipedia/en/Common.css";
		@import "/lib/tpl/monobook/wikipedia/en/Monobook.css";
		@import "/lib/tpl/monobook/dokuwiki/doku.css";
		@import "/lib/tpl/monobook/lang/en/lang.css";
		@import "/lib/tpl/monobook/user/Common.css";
		@import "/lib/tpl/monobook/user/Monobook.css";
		/*]]>*/</style>
    <!--[if lt IE 5.5000]><style type="text/css">@import "/lib/tpl/monobook/monobook/IE50Fixes.css";</style><![endif]-->
    <!--[if IE 5.5000]><style type="text/css">@import "/lib/tpl/monobook/monobook/IE55Fixes.css";</style><![endif]-->
    <!--[if IE 6]><style type="text/css">@import "/lib/tpl/monobook/monobook/IE60Fixes.css";</style><![endif]-->
    <!--[if IE 7]><style type="text/css">@import "/lib/tpl/monobook/monobook/IE70Fixes.css";</style><![endif]-->
    <!--[if lt IE 7]><script type="text/javascript" src="/lib/tpl/monobook/common/IEFixes.js"></script>

    <meta http-equiv="imagetoolbar" content="no" /><![endif]-->
	<style type="text/css"></style></head>
	<body class="mediawiki ns-0 ltr">
		<div id="globalWrapper">
			<div id="column-content">
				<div id="content">
					<a name="top" id="top"></a>
					<div id="siteNotice">


<h1><a name="welcome_to_the_ptokax_wiki" id="welcome_to_the_ptokax_wiki">Welcome to the PtokaX Wiki!</a></h1>
<div class="level1">
<hr>

This wiki is devoted to let users share information on the great hubsoft <a href="http://www.ptokax.org/" class="urlextern" target="_blank" title="http://www.ptokax.org/" rel="nofollow">PtokaX</a>. However, it is not limited to PtokaX, it is destined to share and discuss information on different parts of the LUA programming language, but the site is NOT intended to be a replacement for the <a href="http://luaboard.sytes.net/" class="urlextern" target="_blank" title="http://luaboard.sytes.net/" rel="nofollow">primary LUA Board aka the PtokaX Portal</a>, nor the <a href="http://lua.uknnet.com/" class="urlextern" target="_blank" title="http://lua.uknnet.com/" rel="nofollow">secondary LUA Board</a> or the <a href="http://scriptdb.ptokax.ath.cx/" class="urlextern" target="_blank" title="http://scriptdb.ptokax.ath.cx/" rel="nofollow">PtokaX resources</a>.
<p>
If you’re not familiar with wikis then in short: they are user-contributed sites: pages can be edited by (almost) anyone. As such, there is always kind of up-to-date and (hopefully) proper content. They are better than forums, since relevant pieces of information are on the same page. Do not hesitate to share your knowledge, and we all hope you can learn and teach a lot here!  — <em><a href="mailto:bastyaelvtars@gmail.com" class="mail JSnocheck" title="bastyaelvtars@gmail.com">bastya_elvtars</a></em>
</p>
<hr>
<hr>

</div>

</div>					<div id="bodyContent">
						<div class="dokuwiki">
							<!-- start content -->
														<div id="catlinks"><p class="catlinks"><span class="bchead">Trace:</span> <span class="bcsep">»</span> <a href="http://wiki.ptokax.ch/doku.php/misc/dcprotocol/createlock" class="breadcrumbs" title="misc:dcprotocol:createlock">createlock</a> <span class="bcsep">»</span> <a href="http://wiki.ptokax.ch/doku.php/misc/dcprotocol/intro" class="breadcrumbs" title="misc:dcprotocol:intro">Introduction</a> <span class="bcsep">»</span> <a href="http://wiki.ptokax.ch/doku.php/misc/dcprotocol/c2c_handshake" class="breadcrumbs" title="misc:dcprotocol:c2c_handshake">Client to Client HandShake</a> <span class="bcsep">»</span> <a href="http://wiki.ptokax.ch/doku.php/misc/dcprotocol/c2s_login" class="breadcrumbs" title="misc:dcprotocol:c2s_login">Client to Server Login</a> <span class="bcsep">»</span> <a href="http://wiki.ptokax.ch/doku.php/misc/dcprotocol/s2rs_hubreg" class="breadcrumbs" title="misc:dcprotocol:s2rs_hubreg">Server to Hub Registration Server Communication</a> <span class="bcsep">»</span> <a href="http://wiki.ptokax.ch/doku.php/misc/dcprotocol/c2c" class="breadcrumbs" title="misc:dcprotocol:c2c">Command Types (client to client)</a> <span class="bcsep">»</span> <a href="http://wiki.ptokax.ch/doku.php/misc/dcprotocol/c2s" class="breadcrumbs" title="misc:dcprotocol:c2s">Command Types (client to server)</a> <span class="bcsep">»</span> <a href="http://wiki.ptokax.ch/doku.php/misc/dcprotocol/s2s" class="breadcrumbs" title="misc:dcprotocol:s2s">s2s</a> <span class="bcsep">»</span> <a href="http://wiki.ptokax.ch/doku.php/misc/dcprotocol/experimental" class="breadcrumbs" title="misc:dcprotocol:experimental">experimental</a> <span class="bcsep">»</span> <span class="curid"><a href="./misc dcprotocol lock2key - WikiPx_files/misc dcprotocol lock2key - WikiPx.htm" class="breadcrumbs" title="misc:dcprotocol:lock2key">lock2key</a></span></p></div><div id="qsearch__out" class="ajax_qsearch JSpopup"></div>

<p>
Appendix A: Converting a Lock into a Key
</p>

<p>
As part of the initial negotiation between the client and hub, the hub sends a $Lock &lt;lock&gt; Pk=&lt;pk&gt; command and the client must respond with a $Key &lt;key&gt; command. Until the DCN encoding, which we'll discuss last, the &lt;key&gt; has exactly as many characters as the &lt;lock&gt;.
</p>

<p>
Except for the first, each key character is computed from the corresponding lock character and the one before it. If the first character has index 0 and the lock has a length of len then:
</p>

<p>
for (i = 1; i &lt; len; i++)
</p>
<pre class="code">key[i] = lock[i] xor lock[i-1];</pre>

<p>

The first key character is calculated from the first lock character and the last two lock characters:
</p>

<p>
key[0] = lock[0] xor lock[len-1] xor lock[len-2] xor 5
</p>

<p>
Next, every character in the key must be nibble-swapped:
</p>

<p>
for (i = 0; i &lt; len; i++)
</p>
<pre class="code">key[i] = ((key[i]&lt;&lt;4) &amp; 240) | ((key[i]&gt;&gt;4) &amp; 15)</pre>

<p>

Finally, the characters with the decimal <acronym title="American Standard Code for Information Interchange">ASCII</acronym> values of 0, 5, 36, 96, 124, and 126 cannot be sent to the server. Each character with this value must be substituted with the string /%DCN000%/, /%DCN005%/, /%DCN036%/, /%DCN096%/, /%DCN124%/, or /%DCN126%/, respectively. The resulting string is the key to be sent to the server.
</p>

<p>
If your programming language of choice doesn't have xor or shift operations on characters, convert them to integers. If it doesn't have a bit shift at all, then x « y = x*(2<strong>y) and x » y = x/(2</strong>y) for all integers x and y (** is the exponent operation or “to the power of”). Be sure to use unsigned values everywhere and do not do sign extension. Shift operations always lose the high or low bit (they are not roll operations!). The &amp; (and) and | (or) operations are all logical, not boolean (eg. 6 &amp; 13 = 4, not 1).
</p>

<p>
When the hub connects to the hublist, it must undergo a similar Lock/Key negotiation. The &lt;key&gt; calculation is the same, but the special number 5 in the second step is replaced with the following value is not computed from the hub's listening port, but rather the random outgoing port that the winsock selects. localport:
<sup><a href="http://wiki.ptokax.ch/doku.php/misc/dcprotocol/lock2key#fn__1" name="fnt__1" id="fnt__1" class="fn_top">1)</a></sup> &amp; 255 

</p>
<div class="footnotes">
<div class="fn"><sup><a href="http://wiki.ptokax.ch/doku.php/misc/dcprotocol/lock2key#fnt__1" id="fn__1" name="fn__1" class="fn_bot">1)</a></sup> 
localport»8) + (localport &amp; 255</div>
</div>

<br>
							<div id="catlinks"><p class="catlinks"><span class="bchead">You are here: </span><a href="http://wiki.ptokax.ch/doku.php/homepage" title="homepage">About the Wiki</a> » <a href="http://wiki.ptokax.ch/doku.php/misc/homepage" title="misc:homepage" class="wikilink2" rel="nofollow">misc</a> » <a href="http://wiki.ptokax.ch/doku.php/misc/dcprotocol/homepage" title="misc:dcprotocol:homepage" class="wikilink2" rel="nofollow">dcprotocol</a> » <a href="./misc dcprotocol lock2key - WikiPx_files/misc dcprotocol lock2key - WikiPx.htm" title="misc:dcprotocol:lock2key">lock2key</a></p></div>							<!-- end content -->
							<div class="visualClear"></div>
						</div>
					</div>
				</div>
			</div>

			<div id="column-one">
				<div class="portlet" id="p-logo">
					<a style="background-image: url(/lib/tpl/monobook/user/logo.png);" href="http://wiki.ptokax.ch/" accesskey="h" title="[ALT+H]">
					</a>
				</div>

				<div id="p-cactions" class="portlet"> <h5>Views</h5>   <ul>
<li id="ca-nstab-main" class="selected"><span class="curid"><a href="./misc dcprotocol lock2key - WikiPx_files/misc dcprotocol lock2key - WikiPx.htm" class="wikilink1" title="misc:dcprotocol:lock2key">Article</a></span></li>
<li id="ca-talk"><a href="http://wiki.ptokax.ch/doku.php/talk/misc/dcprotocol/lock2key" class="wikilink2" title="talk:misc:dcprotocol:lock2key" rel="nofollow">Discussion</a></li>
<li id="ca-edit"><a href="http://wiki.ptokax.ch/doku.php?id=misc:dcprotocol:lock2key&do=edit&rev=" accesskey="e" title="[ALT+E]">Show pagesource</a></li>
<li id="ca-history"><a href="http://wiki.ptokax.ch/doku.php?id=misc:dcprotocol:lock2key&do=revisions" accesskey="o" title="[ALT+O]">Old revisions</a></li>
   </ul>
</div><div id="p-x-navigation" class="portlet"> <h5>Navigation</h5><div class="pBody">





<h3><a name="scripting_help" id="scripting_help">Scripting help</a></h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> <a href="http://wiki.ptokax.ch/doku.php/scriptinghelp/tables" class="wikilink1" title="scriptinghelp:tables">Help on tables/arrays</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://wiki.ptokax.ch/doku.php/scriptinghelp/strings" class="wikilink1" title="scriptinghelp:strings">Help on the LUA5 string library</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://wiki.ptokax.ch/doku.php/scriptinghelp/ptokaxapi" class="wikilink1" title="scriptinghelp:ptokaxapi">Help on the old PtokaX LUA API (OBSOLETE)</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://wiki.ptokax.ch/doku.php/scriptinghelp/ptokaxapi2" class="wikilink1" title="scriptinghelp:ptokaxapi2">Help on the new PtokaX LUA API v.2</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://wiki.ptokax.ch/doku.php/scriptinghelp/api2tips" class="wikilink1" title="scriptinghelp:api2tips">Tips for API 2 scripting</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://wiki.ptokax.ch/doku.php/scriptinghelp/api2examples" class="wikilink1" title="scriptinghelp:api2examples">API 2 Example Scripts</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://wiki.ptokax.ch/doku.php/scriptinghelp/pxwsa" class="wikilink1" title="scriptinghelp:pxwsa">The PtokaX WSA (socket) library (OBSOLETE)</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://wiki.ptokax.ch/doku.php/scriptinghelp/metatables_and_metamethods" class="wikilink1" title="scriptinghelp:metatables_and_metamethods">Metatables and metamethods</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://wiki.ptokax.ch/doku.php/scriptinghelp/file_manipulation" class="wikilink1" title="scriptinghelp:file_manipulation">File manipulation</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://wiki.ptokax.ch/doku.php/scriptinghelp/osdate" class="wikilink1" title="scriptinghelp:osdate">Help on the Operating System Lua Library functions</a></div>
</li>
</ul>

</div>

<h3><a name="setting_up_using_the_hubsoft" id="setting_up_using_the_hubsoft">Setting up &amp; using the hubsoft</a></h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> <a href="http://wiki.ptokax.ch/doku.php/settingup/compile_and_setting_debian_bugbuntu" class="wikilink1" title="settingup:compile_and_setting_debian_bugbuntu">Compile and setup on Debian/Ubuntu</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://wiki.ptokax.ch/doku.php/settingup/compile_and_setting_centos" class="wikilink1" title="settingup:compile_and_setting_centos">Compile and setup on CentOS</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://wiki.ptokax.ch/doku.php/settingup/compile_and_setting_freebsd" class="wikilink1" title="settingup:compile_and_setting_freebsd">Compile and setup on FreeBSD</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://wiki.ptokax.ch/doku.php/settingup/setting_up_new_ptokax" class="wikilink1" title="settingup:setting_up_new_ptokax">Setting up PtokaX</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://wiki.ptokax.ch/doku.php/settingup/running_and_using_ptokax" class="wikilink2" title="settingup:running_and_using_ptokax" rel="nofollow">Running and using PtokaX</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://wiki.ptokax.ch/doku.php/settingup/service_install_guide" class="wikilink1" title="settingup:service_install_guide">PtokaX Service Install Guide</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://wiki.ptokax.ch/doku.php/settingup/setting_up_ptokax" class="wikilink1" title="settingup:setting_up_ptokax">Setting up the 0.3.x versions of PtokaX (OBSOLETE)</a></div>
</li>
</ul>

</div>

<h3><a name="changelogs" id="changelogs">Changelogs</a></h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> <a href="http://wiki.ptokax.ch/doku.php/changelogs/ptokax/main" class="wikilink1" title="changelogs:ptokax:main">PtokaX</a></div>
</li>
</ul>

</div>

<h3><a name="miscellaneous" id="miscellaneous">Miscellaneous</a></h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> <a href="http://wiki.ptokax.ch/doku.php/misc/using_svn" class="wikilink1" title="misc:using_svn">Using SVN</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://wiki.ptokax.ch/doku.php/misc/editors" class="wikilink1" title="misc:editors">Text editors for coding LUA</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://wiki.ptokax.ch/doku.php/misc/dcprotocol/intro" class="wikilink1" title="misc:dcprotocol:intro">DC Protocol Documentation</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://pxlua.pastebin.com/" class="urlextern" target="_blank" title="http://pxlua.pastebin.com/" rel="nofollow">Page to highlight your source at when you are in a discussion on IM/DC++</a></div>
</li>
</ul>

</div>

</div></div>
				<div id="p-personal" class="portlet"> <h5>Personal Tools</h5>  <div class="pBody">   <ul>
<li id="pt-login"><a href="http://wiki.ptokax.ch/doku.php?id=misc:dcprotocol:lock2key&do=login">Login</a></li>
   </ul>
  </div></div>
<div id="p-search" class="portlet">
    <h5>
        <label>Search</label></h5>
    <div class="pBody">
        <form action="http://wiki.ptokax.ch/doku.php" accept-charset="utf-8" id="dw__search" name="search">
            <input type="hidden" name="do" value="search">
            <input id="qsearch__in" name="id" type="text" accesskey="f" value="">
            <input type="button" class="searchButton" id="searchGoButton" value="Go" onclick="document.location.href=&#39;/doku.php?id=&#39; + document.search.qsearch__in.value;">&nbsp;
            <input type="submit" name="fulltext" class="searchButton" value="Search">
        </form>
    </div>
</div>

<div id="p-tb" class="portlet"> <h5>Toolbox</h5>  <div class="pBody">   <ul>
<li id="tb-whatlinkshere"><a href="http://wiki.ptokax.ch/doku.php?id=misc:dcprotocol:lock2key&do=backlink" rel="nofollow">What links here</a></li>
<li id="tb-upload"><a href="http://wiki.ptokax.ch/lib/exe/mediamanager.php?ns=misc:dcprotocol" rel="nofollow">Upload file</a></li>
<li id="tb-special"><a href="http://wiki.ptokax.ch/doku.php?idx=wiki" rel="nofollow">Special Pages</a></li>
<li id="tb-print"><a href="http://wiki.ptokax.ch/doku.php?id=misc:dcprotocol:lock2key&rev=1274813707&mbdo=print" rel="nofollow">Printable Version</a></li>
<li id="tb-permanent"><a href="http://wiki.ptokax.ch/doku.php?id=misc:dcprotocol:lock2key&rev=1274813707" rel="nofollow">Permanent link</a></li>
<li id="tb-cite"><a href="http://wiki.ptokax.ch/doku.php?id=misc:dcprotocol:lock2key&rev=1274813707&mbdo=cite" rel="nofollow">Cite this Article</a></li>
   </ul>
  </div></div>			</div>
			<!-- end of the left (by default at least) column -->
			<div class="visualClear"></div>
<div id="footer">
    <div id="f-poweredbyico">
        <a target="_blank" href="http://wiki.splitbrain.org/wiki:dokuwiki" title="Driven by DokuWiki">
            <img src="./misc dcprotocol lock2key - WikiPx_files/button-dw.png" width="88" height="31" alt="Driven by DokuWiki" border="0"></a></div>
    <div id="f-copyrightico">
        <a target="_blank" href="http://tatewake.com/wiki/projects:monobook_for_dokuwiki" title="Monobook for DokuWiki">
            <img src="./misc dcprotocol lock2key - WikiPx_files/button-mb.png" width="88" height="31" alt="Monobook for DokuWiki" border="0"></a></div>
    <a target="_blank" href="http://wiki.ptokax.ch/feed.php" title="Recent changes RSS feed">
        <img src="./misc dcprotocol lock2key - WikiPx_files/button-rss.png" width="80" height="15" alt="Recent changes RSS feed" border="0"></a> <a target="_blank" href="http://www.php.net/" title="Powered by PHP">
                <img src="./misc dcprotocol lock2key - WikiPx_files/button-php.gif" width="80" height="15" alt="Powered by PHP" border="0"></a> <a target="_blank" href="http://validator.w3.org/check/referer" title="Valid XHTML 1.0">
                        <img src="./misc dcprotocol lock2key - WikiPx_files/button-xhtml.png" width="80" height="15" alt="Valid XHTML 1.0" border="0"></a> <a target="_blank" href="http://jigsaw.w3.org/css-validator/check/referer" title="Valid CSS">
                                <img src="./misc dcprotocol lock2key - WikiPx_files/button-css.png" width="80" height="15" alt="Valid CSS" border="0"></a>
    <ul id="f-list">
        <li id="lastmod">misc/dcprotocol/lock2key.txt · Last modified: 25/05/2010@20:55 by bastya_elvtars<br>
        </li>
        <li id="copyright"></li>
        <li id="usermod"><br>
        </li>
    </ul>
</div>
		</div>
<a href="http://wiki.ptokax.ch/doku.php?do=recent" accesskey="r" style="visibility:hidden;" rel="nofollow">&nbsp;</a>
		<img src="./misc dcprotocol lock2key - WikiPx_files/indexer.php" width="1" height="1" alt="">	

</body></html>